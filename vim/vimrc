cnoremap <expr> q<CR> &diff ? 'qa<CR>' : 'q<CR>'
